<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://ogp.me/ns/fb#"><head><link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
        <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" />
        <link rel="shortcut icon" href="/favicon/favicon.ico" />
        <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
        <link rel="manifest" href="/favicon/site.webmanifest" /><meta name="viewport" content="width=device-width, initial-scale=1"><meta charset="UTF-8"><title>One Radio</title>
<meta property="og:image" content="/assets/default.png" />
<link rel="preload" href="https://internetradioprotocol.org/info" as="fetch" crossorigin="anonymous">


<!-- STATION_DATA_START -->
<!-- STATION_DATA_END --></head><body style="font-family:Archivo Light; padding:10vw; padding-top:10px;">
        
        <div class="the-header" style="display:flex; align-items:center;">
        <img id="main-logo" src="assets/ears.png">
        <p id="title">On<span style="letter-spacing:-0.04em">e</span>-Radio</p></div>
        <div id="play-random">
            <!--<div id="play-random-button">&#x25b6;&#xfe0e;</div>-->
            <div id="play-random-button"><img id="shuffle" src="/assets/shuffle.png"></div>
            <div id="play-random-text">
            </div>
            <div id="intro-div">What's the matter, afraid you might discover something?</div>
        </div>
        <div id="player">
            <div id="player-icons">
                <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M24 22h-24l12-20z"></path></svg>
                <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" version="1.0" width="1262.000000pt" height="1280.000000pt" viewBox="0 0 1262.000000 1280.000000" preserveAspectRatio="xMidYMid meet"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="rgb(0,0,0,255)" stroke="#000000" stroke-width="0"><path d="M669 12214 c-59 -18 -130 -81 -160 -141 l-24 -48 0 -5650 0 -5650 23 -47 c13 -26 43 -65 67 -87 83 -77 -104 -71 2295 -71 2400 0 2212 -6 2295 71 24 23 54 62 67 87 l23 47 0 5650 0 5650 -23 47 c-13 25 -43 64 -67 87 -83 77 105 71 -2299 70 -1824 0 -2158 -3 -2197 -15z"></path><path d="M7542 12211 c-63 -22 -123 -76 -155 -141 l-22 -45 0 -5650 0 -5650 23 -47 c13 -25 43 -64 67 -87 83 -77 -105 -71 2295 -71 2399 0 2212 -6 2295 71 24 22 54 61 67 87 l23 47 0 5650 0 5650 -24 48 c-31 63 -101 123 -164 142 -44 13 -321 15 -2201 15 -2062 -1 -2153 -1 -2204 -19z"></path></g></svg>
            </div>
            <div id="player-things">
                <img id="player-img" src="">
                <div id="player-info-div">
                    <div id="player-name"></div>
                    <div id="player-info"><span class="one-liner"></span></div>
                    <div id="player-location"></div>
                </div>
                <audio id="player-audio" style="width:40px;" data-src=""></audio>
            </div>
            <div id="share-icon">
                <i id="share" class="fa-solid fa-link"></i>
            </div>
        </div>
        <!--<div id="intro-div">Up-to-the-minute information and direct stream links for the world's best internet radio stations. Click a logo to tune in, donate to a station if you like it, and follow me on Instagram, <a class='insta-link' target='_blank' href='https://www.instagram.com/scud.works/'>@scud.works</a>. Last updated <span class='last-updated'></span><span class='live-count'></span>.</div>-->
        
        <div class="tag-container-container">
            <div class="tags-container" id="status-tags-container">
                <div class="tag status-tag" data-type="status" id="Live-tag">Live</div>
                <div class="tag status-tag" data-type="status" id="Re-Run-tag">Re-Run</div>
                <div class="tag status-tag" data-type="status" id="Offline-tag">Offline</div>
            </div>
            <div class="tags-container" id="location-tags-container">
            </div>
            <div class="tags-container" id="genre-tags-container">
            </div>
        </div>

        <div class="streams-container" id="favorites-container"></div>
        
        <div class="streams-container" id="streams-container"></div>
        You can access this information and more in JSON format at <a target="_blank" href="https://internetradioprotocol.org/info">internetradioprotocol.org/info</a>.<br><br>
        If you have any questions, comments, or radio station addition suggestions, please email <a href="mailto:brayden@braydenmoore.com">brayden@braydenmoore.com</a> or open an issue on <a target="_blank" href="https://github.com/brayden1moore/internet-radio-protocol">Github</a>. <br><br>
        <!--Lastly, check out the tuner I am making:<br><br><a href="https://www.instagram.com/scud.works/" target="_blank" style="border:none !important; height:250px;"><img height="auto" width="100%" style="border: 1px solid black;" src="assets/sr.JPG"></a>-->
        Last updated <span class='last-updated'></span><span class='live-count'></span></body></html><style>

    
    @keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
    }

    #shuffle {
        height: 40px;
        width: 40px;
    }

.a-station-container {
    animation: fadeIn 0.5s ease-out;
}
            
        #player-icons {
            margin-right: 15px;
            z-index: 2000;
        }

        #player-location {
            font-size: 8pt;
        }

    #player-name {
        font-size: 14pt;
        margin-bottom: 0;
        background-color: #000000;
        color: white;
        width: fit-content;
        margin-bottom: 3px;
    }


       #play-icon {
        transform: rotate(90deg);
        }
        #play-icon {
        width: 30px;
        height: 30px;
        }

        body {
            color: black;
        }

        #pause-icon {
        height: 37px;
        width: 30px;
        display: none;
        }

        .player-paused {
            background-color: #FFF !important;
        }

        #player-info-div {
            display: block;
        }

        #player-img {
            border: 1px solid black;
            height: 56px;
            width: 56px;
            margin-right: 15px;
            z-index: 1001;
        }

        #player-things {
            display: flex;
            align-items: center;
        }

        #player-icons {
            cursor: pointer;
        }

        #share-icon {
            cursor: pointer;
            margin-left: auto;
            padding-right: 35px;
            font-size: 20pt;
        }
            
        #player {
            white-space: nowrap;
            /*justify-content: space-between;*/
            cursor: default;
            align-items: center;
            padding: 10px;
            padding-left: 15px;
            height: 58px;
            position: fixed;
            bottom: 0px;
            left: 0px;
            width: 100%;
            z-index: 1000;
            background-color: #00BBFF;
            border: 1px solid black;
            display: none;
        }
        ::-webkit-scrollbar {
        display: none;
        }
        .tag-container-container {
            margin-top: 22px;
            width: 100%;
        }
        .tags-container {
            scrollbar-width: thin;
            display: flex;
            flex-basis: 100%; height: 0;
            width: 100%;
            height: auto;
            overflow-x: scroll;
        }
        #location-tags-container {
            margin-top: 0px;
        }
        #status-tags-container {
            margin-top: 5px;
        }
        .active-tag {
            opacity: 1 !important;
        }
        .inactive-tag {
            opacity: 0.5 !important;
        }
        .status-tag {
            background-color: #FF4747;
        }
        .location-tag {
            background-color: #00BBFF;
        }
        .genre-tag {
            background-color: #00E7C0;
        }
        .tag {
            height: 15px;
            width: fit-content;
            cursor: pointer;
            /*border-radius: 20px;*/
            opacity: 1;
            border: 1px solid black;
            margin-right: 3px;
            padding: 6px;
            padding-bottom: 7px;
            padding-left: 9px;
            padding-right: 9px;
            margin-bottom: 4px;
        }
        .tag:hover {
            opacity: 0.7;
        }

        .insta-link {
            color: white !important;
            border-bottom: 1px white solid !important;
        }
        .insta-link:hover {
            color: black !important;
            background-color: white !important;
        }

        #intro-div {
            padding: auto;
            text-align: center;
            justify-content: center;
            display: flex;
            height: 55px;
            border: 1px solid black;
            background-color: black;
            color: white;
            align-items: center;
            padding-right: 10px;
            padding-left: 10px;   
        }

        #play-random {
            display: flex;
            align-items: center;
        }

        #play-random-button {
            cursor: pointer;
            width: auto;
            display: flex;
            background-color: yellow;
            border: 1px solid black;
            padding: 8px;
            margin-right: 8px;
            border-radius: 0px;
            font-size: 18pt;
        }
        #play-random-button:hover {
            background-color: #ddd;
        }

        #play-random-text {
            cursor: pointer;
        }

        #title {
            margin-left: 0px;
        }
        

        .one-liner {
            font-size: 8pt;
        will-change: transform;
        backface-visibility: hidden;
        }

        .one-liner > div {
        will-change: transform;
        backface-visibility: hidden;
        }

        .one-liner > div:hover {
        animation-play-state: paused;
        }

        .one-liner span {
        transform: none !important;
        animation: none !important;
        will-change: transform;
        backface-visibility: hidden;
        }

        .flash {
        background-color: white !important;
        color: black !important;
        }

        .flash-out {
        transition: background-color 1s ease-out, color 1s ease-out;
        }

        .stream-name {background-color:#000000 !important; color:#FFFFFF !important}
        .links {display:flex; margin-top: 10px; margin-bottom: 8px;}
        .a-link {font-size: 8pt !important; margin-right: 10px;}
        .support-link {background-color:#FFFF00; }
        .info-link {display:none}

        #favorites-container {
            padding-bottom: 25px;
            border-bottom: solid black 1px;
        }

        .favorite-star-favorited {
            font-size: 14pt;
            opacity: 0;
            color: yellow;
        }
        
        .favorite-star {
            font-size: 14pt;
            opacity: 0.2;
        }
        .favorite-star:hover {
            opacity: 1;
        }


        #main-logo {height: 100px; margin-left: -13px;
            animation: rotate 6s linear infinite;
        }
        .a-station-container {
            animation: fadeIn 0.5s ease-out forwards;
            position:relative; 
            border-radius: 0px;
              user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            isolation: isolate;
            overflow: auto;
            cursor:default; 
            background-color: #FFFFFF; 
            color:#000000; height: 90px; padding: 10px; overflow-x:hidden; overflow-y:hidden; border:1px solid black; align-items: center; display: flex; white-space: nowrap;}
        .offline {
            opacity: 0.5;
        }
        
        .a-logo {border-radius:0px; width:90px; height:90px; margin-right:10px; border: 1px solid black; cursor: pointer; flex-shrink: 0;}
        body {background-color: #FFFFFF; font-size: 10pt;}
        .the-header {font-family: "Archivo Bold"; font-size: 40pt; line-height:0.75em; letter-spacing:-0.09em; margin-top:25px;margin-bottom:-20px;}
        .a-station {font-family: "Archivo Light"; font-size:8pt; white-space: nowrap; flex-shrink: 0;}
        
        @font-face {font-family: "Archivo Bold";src: url("assets/Archivo-Bold.ttf") format("truetype");}
        
        a {font-size: 10pt; color:#000000; border-bottom: 1px solid black; text-decoration: none;}
        a:hover {background-color: #000000; color:#FFFFFF}
       
        @font-face {font-family: "Archivo Light";src: url("assets/Archivo-Light.ttf") format("truetype");}
        @keyframes rotate{
            0% {
                transform: rotate(0deg)
            }
            100% {
                transform: rotate(360deg);
            }
        }
         @keyframes pulse{0%{background:#ffffff}50%{background:#ddd}100%{background:#ffffff}}.pulsing{animation:pulse 1s infinite}
        .streams-container {display: grid; grid-template-columns: 1fr; gap: 20px; margin-top: 20px; margin-bottom:20px;}
        @media (min-aspect-ratio: 8/10) 
        {

        .one-liner {
            font-size: 10pt;
                    }

        #player-location {
            font-size: 10pt;
        }
        .tags-container {
            flex-wrap: nowrap;
        }
        .info-link {display:block}
        body{font-size: 12pt;} 
        .a-link {font-size: 10pt !important;}
        .a-station-container {height:140px;} 
        .dragging {
            opacity: 0.5 !important;
        }
        .streams-container {grid-template-columns: 1fr 1fr;} 
        .the-header{
            font-size: 60pt;
        } .a-station {font-size:10pt;} 
        .a-logo {width:140px; height:140px;} a {font-size: 12pt}
        #main-logo {height: 144px; margin-left:-15px}
        #title {margin-left: 0px;}
        }

        @media (orientation: landscape) 
        {
            .streams-container {grid-template-columns: 1fr 1fr 1fr 1fr;} 
        }
        </style><script>

        const player = document.getElementById('player');
        const playerImg = document.getElementById('player-img');
        const playerName = document.getElementById('player-name');
        const playerInfo = document.getElementById('player-info');
        const playerLocation = document.getElementById('player-location');
        const playerAudio = document.getElementById('player-audio');
        const playerIcons = document.getElementById('player-icons');
        const playIcon = document.getElementById('play-icon');
        const pauseIcon = document.getElementById('pause-icon');

        playerIcons.addEventListener('click', togglePlayer);

        function togglePlayer() {
            console.log(playerAudio.paused);
            document.querySelectorAll('.a-station-container').forEach(station=>{
                station.style.backgroundColor='white';
                station.classList.remove('pulsing')
            });
            
            const id = player.dataset.id;
            const theStation = document.getElementById(id);  

            if (playerAudio.paused) {
                playerAudio.load();
                theStation.classList.add('pulsing');           
                playIcon.style.display = 'none';
                pauseIcon.style.display = 'block';
                player.classList.remove('player-paused');
                player.classList.add('pulsing');                
                playerAudio.play().then(()=>{
                    player.classList.remove('pulsing');      
                    theStation.classList.remove('pulsing');          
                    theStation.style.backgroundColor = 'yellow';
                });
            }
            else {
                playIcon.style.display = 'block';
                pauseIcon.style.display = 'none';
                playerAudio.pause();
                player.classList.add('player-paused');
            }
        }


        function chooseStation(id, random=false, fromLink=false) {
            document.title = `${id} - Internet Radio Protocol`;

            player.style.display = 'flex';

            let d=document.getElementById(id)
            let isPlaying=d.style.backgroundColor==='yellow';

            const randomButton = document.getElementById('play-random-button');
            const playRandomText = document.getElementById('play-random-text');

            const station = document.getElementById(id)
            const oneLiner = station.dataset.oneLiner;
            const logo = station.querySelector('.a-logo').src;
            document.querySelectorAll('meta[property=og\\:image]')[0].setAttribute('content', logo.replace('https://internetradioprotocol.org',''))


            playerImg.src = logo;
            player.dataset.id = id;
            playerName.textContent = id;

            const a=document.getElementById(`${id}-audio`);
            playerAudio.src = a.dataset.src; 

            updatePlayer(id, oneLiner, station.dataset.location);
            updateMediaSession(oneLiner, id, logo);
            console.log('From Link')
            console.log(fromLink);
            if (!fromLink) {
                player.classList.add('pulsing');
                togglePlayer();
            }
        }
                        
        document.querySelectorAll('.last-updated').forEach(el => {const utcStr = el.dataset.utc;if (utcStr) {const date = new Date(utcStr);if (!isNaN(date)) {el.textContent = date.toLocaleString();}}});

        function playRandom() {
            let alreadyPlaying = true;
            const stationContainers = document.querySelectorAll('.a-station-container');
            const idList = Array.from(stationContainers).map(container => container.id);
            let oneLiner = '';
            let id = '';
            while (alreadyPlaying) {
                let choice = Math.floor(Math.random() * idList.length);
                id = idList[choice];
                alreadyPlaying = !document.getElementById(`${id}-audio`).paused;
                if (!alreadyPlaying) {
                        const container = document.getElementById(id);
                        oneLiner = container.dataset.oneLiner;
                        status = container.dataset.status;
                        if (status == "Offline") {
                            alreadyPlaying = true;
                        }
                }
            }
            chooseStation(id, true);
        }

        const playRandomButton = document.getElementById('play-random-button');
        playRandomButton.addEventListener('click', playRandom);

        const playRandomTextElement = document.getElementById('play-random-text');
        playRandomTextElement.addEventListener('click', function() {
            const previewSpan = playRandomTextElement.querySelector('span');
            const id = previewSpan.id.replace('previewFor-', '');
            element = document.getElementById(id)
            const yOffset = -1 * (window.innerHeight / 2) + 100;
            const y = element.getBoundingClientRect().top + window.scrollY + yOffset;
            window.scrollTo({top: y, behavior: 'smooth'});
        });

        function calculateMarquees(stationContainers) {
            //const stationContainers = document.querySelectorAll('.a-station-container');
            let needsMarquee = false;
            stationContainers.forEach((container) => {
                const logo = container.querySelector('.a-logo');
                const nowPlaying = container.querySelector('.now-playing');
                const oneLiner = container.querySelector('.one-liner');
                const width = (container.offsetWidth - logo.offsetWidth - (nowPlaying.offsetWidth - oneLiner.offsetWidth)) + 'px';
                needsMarquee = (container.offsetWidth - logo.offsetWidth - nowPlaying.offsetWidth) < 30;
                if (needsMarquee) {
                    setupOneLinerMarquee(oneLiner, width, 'left');
                };
            });
        }

        function setupOneLinerMarquee(oneLinerElement, width, direction = 'left') {
            const text = oneLinerElement.textContent;
            const textLength = text.length;
            
            const wrapper = document.createElement('div');
            wrapper.style.cssText = `
                overflow: hidden;
                white-space: nowrap;
                display: inline-block;
                width: ${width};
                position: relative;
                top: 3px;
                will-change: transform;
                backface-visibility: hidden;
            `;
            
            const scrollContainer = document.createElement('div');
            scrollContainer.style.cssText = `
                display: inline-block;
                white-space: nowrap;
                will-change: transform;
                backface-visibility: hidden;
            `;
            
            const originalSpan = document.createElement('span');
            originalSpan.classList.add('marqueeOneLiner');
            originalSpan.textContent = text;
            originalSpan.style.cssText = `
                display: inline-block;
                margin-right: 40px;
                will-change: transform;
                backface-visibility: hidden;
            `;
            
            const clonedSpan = originalSpan.cloneNode(true);
            
            scrollContainer.appendChild(originalSpan);
            scrollContainer.appendChild(clonedSpan);
            oneLinerElement.innerHTML = '';
            oneLinerElement.appendChild(wrapper);
            wrapper.appendChild(scrollContainer);
            
            scrollContainer.offsetHeight;
            
            const computedStyle = window.getComputedStyle(originalSpan);
            const marginRight = parseFloat(computedStyle.marginRight) || "10px";
            const totalWidth = originalSpan.offsetWidth + marginRight;
            const duration = totalWidth / 25; 
            
            const uid = Math.random().toString(36).substr(2, 5);
            const animName = `scroll-oneliner-${direction}-${uid}`;
            
            const styleElement = document.createElement('style');
            
            if (direction === 'left') {
                scrollContainer.style.transform = 'translateX(0px)';
                styleElement.textContent = `
                @keyframes ${animName} {
                    0% { transform: translateX(0px); }
                    20% { transform: translateX(0px); }
                    100% { transform: translateX(-50%); }
                }
                `;
            } else {
                scrollContainer.style.transform = 'translateX(-50%)';
                styleElement.textContent = `
                @keyframes ${animName} {
                    0% { transform: translateX(-50%); }
                    100% { transform: translateX(0px); }
                }
                `;
            }
            
            document.head.appendChild(styleElement);
            
            scrollContainer.style.cssText += `
                animation-name: ${animName};
                animation-duration: ${duration}s;
                animation-timing-function: linear;
                animation-iteration-count: infinite;
                animation-fill-mode: forwards;
                will-change: transform;
                backface-visibility: hidden;
                transform: translateZ(0);
            `;
        }


        function decodeHtmlEntities(text) {
            const textarea = document.createElement('textarea');
            textarea.innerHTML = text;
            return textarea.value;
        }

        let locationTagActive = false;
        let statusTagActive = false;
        let genreTagActive = false;
        let activeLocationTags = [];
        let activeStatusTags = [];
        let activeGenreTags = [];

        function resetTags() {
            const theseTags = document.querySelectorAll(`.${tagType}-tag`);
            theseTags.forEach(otherTag => {
                otherTag.classList.remove('active-tag');
            });
        }
        function toggleTag(tag) {
            const tagType = tag.dataset.type;
            const stations = document.querySelectorAll('.a-station-container');
            const theseTags = document.querySelectorAll(`.tag`)
            const tagsInRow = document.querySelectorAll(`.${tagType}-tag`);

            // update tag divs
            if (tag.classList.contains('active-tag')) {
                tag.classList.remove('active-tag');
            }
            else {
                tag.classList.add('active-tag');
            }

            // get active tag list
            activeLocationTags = [];
            activeStatusTags = [];
            activeGenreTags = [];
            locationTagActive = false;
            statusTagActive = false;
            genreTagActive = false;

            theseTags.forEach(thisTag => {
                if (thisTag.dataset.type == 'location') {
                    if (thisTag.classList.contains('active-tag')) {
                        locationTagActive = true;
                        activeLocationTags.push(thisTag.id.replace('-tag',''));               
                    }      
                }
                else if (thisTag.dataset.type == 'status') {
                    if (thisTag.classList.contains('active-tag')) {
                        statusTagActive = true;
                        activeStatusTags.push(thisTag.id.replace('-tag',''));               
                    }            
                }   
                else if (thisTag.dataset.type == 'genre') {
                    if (thisTag.classList.contains('active-tag')) {
                        genreTagActive = true;
                        activeGenreTags.push(thisTag.id.replace('-tag',''));               
                    }         
                }   
            });

            // Determine which list to use based on the clicked tag type
            let thisTagList;
            if (tagType == 'location') {
                thisTagList = activeLocationTags;
            } else if (tagType == 'status') {
                thisTagList = activeStatusTags;
            } else if (tagType == 'genre') {
                thisTagList = activeGenreTags;
            }

            // update tags in row
            tagsInRow.forEach(tagInRow => {
                if ((!thisTagList.includes(tagInRow.id.replace('-tag',''))) && (thisTagList.length > 0)) {
                    tagInRow.classList.add('inactive-tag');
                    console.log('made inactive');
                } else {
                    // Remove inactive-tag if it should be active
                    tagInRow.classList.remove('inactive-tag');
                }
            });
            
            // update station divs
            stations.forEach(station => {
                station.style.display = 'flex';
                if (
                    (activeLocationTags.includes(station.getAttribute(`data-location`)) | activeLocationTags.length==0) 
                    & (activeStatusTags.includes(station.getAttribute(`data-status`)) | activeStatusTags.length==0) 
                    & (activeGenreTags.some(genre => {return station.getAttribute(`data-genres`).includes(genre);}) | activeGenreTags.length==0)
                ) {
                    station.style.display = 'flex';
                }
                else {
                    station.style.display = 'none';
                    /*
                    if (station.dataset.favorited !== 'true') {
                        station.style.display = 'none';
                    }
                    */
                }
            })

        }

          

        function updatePlayer(id, oneLiner, location) {
            existingStation = document.getElementById(id);
            oneLinerElement = playerInfo.querySelector('.one-liner');
            existingOneLiner = decodeHtmlEntities(oneLinerElement.dataset.oneLiner)

            if (existingOneLiner != oneLiner) {
                oneLinerElement.textContent = oneLiner;
                playerLocation.textContent = location;
                oneLinerElement.textContent = oneLiner;
                oneLinerElement.dataset.oneLiner = oneLiner; 
            };

            const width = (player.offsetWidth - playerImg.offsetWidth - playerIcons.offsetWidth - (playerInfo.offsetWidth - oneLinerElement.offsetWidth)) + 'px';
            needsMarquee = (player.offsetWidth - playerImg.offsetWidth - playerInfo.offsetWidth - playerIcons.offsetWidth) < 50;
            if (needsMarquee) {
                setupOneLinerMarquee(oneLinerElement, width, 'left');
            };
        }

        function populateStations(data) {
            var rerun = 0;
            var live = 0;
            var offline = 0;

            const keys = Object.keys(data);
            keys.sort((a, b) => {
            const lowerA = a.toLowerCase();
            const lowerB = b.toLowerCase();
            if (lowerA < lowerB) {
                return -1;
            }
            if (lowerA > lowerB) {
                return 1;
            }
            return 0; 
            });

            const container = document.getElementById('streams-container');
            const updatedOneLiners = [];
            const offliners = [];

            keys.forEach(function(stationName) {
                const station = data[stationName];
                const oneLiner = decodeHtmlEntities(data[stationName]['oneLiner']);
                const location = data[stationName]['location'];
                const genres = data[stationName]['genres'];
                const status = data[stationName]['status'];
                const streamLink = data[stationName]['streamLink'];
                const mainLink = data[stationName]['mainLink'];
                const infoLink = data[stationName]['infoLink'];
                const donateLink = data[stationName]['donateLink'];
                const logo = data[stationName]['logo'];
                const hidden = data[stationName]['hidden'];
                
                const existingStation = document.getElementById(stationName);
                if (existingStation) {
                    existingOneLiner = decodeHtmlEntities(existingStation.dataset.oneLiner);
                    if (existingOneLiner != oneLiner) {
                        existingStation.querySelector('.one-liner').textContent = oneLiner;
                        existingStation.dataset.oneLiner = oneLiner; 
                        updatedOneLiners.push(existingStation);
                    };
                    existingStation.querySelector('.status').textContent = status;
                    existingStation.querySelector('.location').textContent = location;

                    existingStation.dataset.location = location;
                    existingStation.dataset.status = status;
                    existingStation.dataset.genres = genres;

                    if (existingStation.id == player.dataset.id) {
                        updatePlayer(stationName, oneLiner, location);
                        updateMediaSession(oneLiner, stationName, logo);
                    }
                }
                else {
                    const stationDiv = document.createElement('div')
                    stationDiv.classList.add('a-station-container');
                    stationDiv.dataset.location = location;
                    stationDiv.dataset.status = status;
                    stationDiv.dataset.oneLiner = oneLiner; 
                    stationDiv.dataset.genres = genres;
                    stationDiv.setAttribute('draggable', true);
                    stationDiv.id = stationName;    
                              
                    stationDiv.innerHTML = `
                    <p class="favorite-star-favorited" id="${stationName}-favorite" style="position: absolute; top: 10px; right: 10px; margin: 0; cursor: pointer; z-index: 10;">★</p>
                    <p class="favorite-star" onClick="toggleFavorite('${stationName}')"  id="${stationName}-favorite-outline" style="position: absolute; top: 10px; right: 10px; margin: 0; cursor: pointer; z-index: 11;">☆</p>
                    <img class="a-logo"  onclick="chooseStation('${stationName}')" src="${logo}"  />
                    <div class="a-station">
                    <a class="stream-name" target="_blank" href="${mainLink}">${stationName}</a>
                    <div class="links">
                        <a class="a-link" target="_blank" href="${streamLink}">Stream</a>
                        <a class="a-link" target="_blank" href="${mainLink}">Website</a>
                        <a class="a-link info-link" target="_blank" href="${infoLink}">Info</a>
                        <a class="a-link support-link" target="_blank" href="${donateLink}">Donate</a>
                    </div>
                    <span class="now-playing">Playing: <span id="${stationName}-oneLiner" class="one-liner">${oneLiner}</span></span><br>
                    Location: <span class="location">${location}</span><br>Status: <span class="status">${status}</span><br>
                    <audio id="${stationName}-audio" style="width:40px;" data-src="${streamLink}"></audio>
                    </div>`

                    if (hidden != true) {
                        if (status === 'Offline') {
                            stationDiv.classList.add('offline');
                            offliners.push(stationDiv);
                        }
                        else {
                            container.appendChild(stationDiv);
                        }
                    }

                    updatedOneLiners.push(stationDiv);
                }

                if (hidden != true) {
                    if (status === 'Offline') {
                        offline++;
                    }
                    else {
                        if (status === 'Re-Run') {
                            rerun++;
                        }
                        else {
                            live++;
                        }
                    }
                }
            
            });

            // add offline stations last
            offliners.forEach(station => {
                container.appendChild(station);
            })
            
            const liveCount = document.querySelector('.live-count');
            liveCount.textContent = ` - ${live + offline + rerun} total, ${live + rerun} online, ${live} live, ${offline} offline`;
            
            const lastUpdated = document.querySelector('.last-updated');
            const now = new Date();
            const formatter = new Intl.DateTimeFormat('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric',
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            });
            
            lastUpdated.textContent = formatter.format(now);
            lastUpdated.classList.add('flash');
            setTimeout(function() {
                lastUpdated.classList.add('flash-out');
                lastUpdated.classList.remove('flash');
            }, 100);
            setTimeout(function() {
                lastUpdated.classList.remove('flash-out');
            }, 1100);

            calculateMarquees(updatedOneLiners);
        }

        function populateTags(data) {
            // create locations and genres
            const locationTagsContainer = document.getElementById('location-tags-container');
            locationTagsContainer.innerHTML = "";
            const genreTagsContainer = document.getElementById('genre-tags-container');
            genreTagsContainer.innerHTML = "";

            const locations = [];
            const genres = [];

            Object.keys(data).forEach(function(stationName) {
                thisLocation = data[stationName]['location'];
                if (!locations.includes(thisLocation)) {
                        locations.push(thisLocation);
                }

                theseGenres = data[stationName]['genres'];
                if (theseGenres) {
                    theseGenres.forEach(thisGenre => {
                        if (!genres.includes(thisGenre)) {
                                genres.push(thisGenre);
                        }                    
                    })
                }
            });

            locations.sort();
            locations.forEach(location => {
                const locationTag = document.createElement('div');
                locationTag.id = `${location}-tag`;
                locationTag.classList.add('location-tag');
                locationTag.classList.add('tag');
                locationTag.textContent = location.replace(/ /g, "\u00A0");
                locationTag.dataset.type = "location";
                locationTagsContainer.appendChild(locationTag);
                locationTag.addEventListener('click',function() {
                    toggleTag(locationTag);
                });
            });
            
            genres.sort();
            genres.forEach(genre => {
                const genreTag = document.createElement('div');
                genreTag.id = `${genre}-tag`;
                genreTag.classList.add('genre-tag');
                genreTag.classList.add('tag');
                genreTag.textContent = genre.replace(/ /g, "\u00A0");
                genreTag.dataset.type = "genre";
                genreTagsContainer.appendChild(genreTag);
                genreTag.addEventListener('click',function() {
                    toggleTag(genreTag);
                });
            });

            // add event listener to statuses
            const statusTags = document.querySelectorAll('.status-tag');
            statusTags.forEach(status => {
                status.addEventListener('click',function() {
                    toggleTag(status);
                });
            })
        }
        

        function updateMediaSession(title, artist, artwork) {
            if ('mediaSession' in navigator) {
                navigator.mediaSession.metadata = new MediaMetadata({
                title: title,
                artist: artist,
                album: 'Internet Radio Protocol',
                artwork: [
                    { src: artwork, sizes: '96x96',   type: 'image/png' },
                    { src: artwork, sizes: '128x128', type: 'image/png' },
                    { src: artwork, sizes: '256x256', type: 'image/png' },
                    { src: artwork, sizes: '512x512', type: 'image/png' }
                ]
                });

                navigator.mediaSession.setActionHandler('play', () => {
                togglePlayer();
                });
                
                navigator.mediaSession.setActionHandler('pause', () => {
                togglePlayer();
                });
            }
        }

        const firstLoad = true;
        function getUpdatedInfo(from_endpoint=true) {
            let favorites = JSON.parse(localStorage.getItem('favorites')) || [];

            if (window.STATION_DATA && from_endpoint == false) {
                console.log('pulling from index.html')
                json = window.STATION_DATA;
                populateStations(json);

                if (locationTagActive == false & statusTagActive == false & genreTagActive == false) {
                    populateTags(json);
                }
                
            } else {
                fetch('https://internetradioprotocol.org/info')
                    .then(response => response.json())
                    .then(json => {
                        populateStations(json);
                        if (firstLoad) {
                            distributeFavorites(favorites);
                        }
                        if (locationTagActive == false & statusTagActive == false & genreTagActive == false) {
                            populateTags(json);
                        }
                    })
                    .catch(error => console.error('Fetch error:', error));
            }

            firstLoad = false;
        }

        function distributeFavorites(favorites) {
            const favoriteDiv = document.getElementById('favorites-container');
            const originalContainer = document.getElementById('streams-container');
            
            if (favorites.length == 0) {
                favoriteDiv.style.display = "none";
            } else {
                favoriteDiv.style.display = "grid";
            }
            
            const allFavoriteStations = favoriteDiv.querySelectorAll('.a-station-container');
            allFavoriteStations.forEach((station) => {
                
                originalContainer.insertBefore(station, originalContainer.firstChild);
                
                station.dataset.favorited = 'false';
                
                let favoriteStar = station.querySelector('.favorite-star-favorited');
                let favoriteOutline = station.querySelector('.favorite-star');
                
                if (favoriteStar) favoriteStar.style.opacity = '0';
                if (favoriteOutline) favoriteOutline.style.opacity = '0.2';

            });
            
            favorites.forEach((stationId) => {
                let stationDiv = document.getElementById(stationId);
                if (stationDiv) {
                    stationDiv.dataset.favorited = 'true';

                    let favoriteStar = stationDiv.querySelector('.favorite-star-favorited');
                    let favoriteOutline = stationDiv.querySelector('.favorite-star');
                    
                    if (favoriteStar) favoriteStar.style.opacity = '1';
                    if (favoriteOutline) favoriteOutline.style.opacity = '1';

                    favoriteDiv.appendChild(stationDiv);
                }
            });
        }

        function toggleFavorite(id) {
            let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
            const index = favorites.indexOf(id);
            if (index > -1) {
                favorites.splice(index, 1);
            } else {
                favorites.push(id);
            }
            localStorage.setItem('favorites', JSON.stringify(favorites));
            distributeFavorites(favorites);
        }

        document.addEventListener('DOMContentLoaded', () => {
            let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
            distributeFavorites(favorites);

            // get station from URL
            const params = new Proxy(new URLSearchParams(window.location.search), {
                get: (searchParams, prop) => searchParams.get(prop),
            });
            let value = params.station;
            console.log(value);
            if (value) {
                chooseStation(value, false , true);
            }
        });

      const shareIcon = document.getElementById("share");
      const copiedText = document.getElementById("copied");

      shareIcon.addEventListener("click", function() {
          const id = player.getAttribute("data-id").replace(" ","%20");
          const urlToCopy = `${window.location.origin}/?station=${id}`;
          
          navigator.clipboard.writeText(urlToCopy).then(() => {
              console.log("URL copied to clipboard");
              shareIcon.className = "fa-solid fa-check";
              //copiedText.style.visibility = "visible";
          }).catch(err => {
              console.log("Could not copy text: ", err);
          });
      });
        
        getUpdatedInfo(false);

        setTimeout(() => {
            setInterval(getUpdatedInfo, 10000);
        }, 1000);

        </script>
